"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return u}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=p(n),u=i,c=h["".concat(l,".").concat(u)]||h[u]||m[u]||r;return n?a.createElement(c,o(o({ref:t},d),{},{components:n})):a.createElement(c,o({ref:t},d))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6241:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},metadata:function(){return l},toc:function(){return p},default:function(){return m}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),o=["components"],s={id:"sending",title:"Web Monetization Providers (Sending Payments)",sidebar_label:"Sending payments"},l={unversionedId:"sending",id:"sending",isDocsHomePage:!1,title:"Web Monetization Providers (Sending Payments)",description:"This page is a proposal for how browsers can implement Web Monetization. All",source:"@site/docs/sending.md",sourceDirName:".",slug:"/sending",permalink:"/docs/sending",editUrl:"https://github.com/WICG/webmonetization/tree/main/docs/sending.md",version:"current",sidebar_label:"Sending payments",frontMatter:{id:"sending",title:"Web Monetization Providers (Sending Payments)",sidebar_label:"Sending payments"},sidebar:"docs",previous:{title:"Web Monetization Receivers",permalink:"/docs/receiving"},next:{title:"Digital Wallet and Payment Pointers",permalink:"/docs/ilp-wallets"}},p=[{value:"Payment Handler API",id:"payment-handler-api",children:[{value:"<code>monetization</code> - payment method",id:"monetization---payment-method",children:[]},{value:"<code>PaymentRequestEvent</code> - event",id:"paymentrequestevent---event",children:[]},{value:"<code>MonetizationRequest</code> - dictionary",id:"monetizationrequest---dictionary",children:[]},{value:"<code>MonetizationResponse</code> - dictionary",id:"monetizationresponse---dictionary",children:[]}]},{value:"Open authorization issues",id:"open-authorization-issues",children:[]},{value:"Supporting payment streams",id:"supporting-payment-streams",children:[]}],d={toc:p};function m(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"This page is a proposal for how browsers can implement Web Monetization. All\ninformation is considered experimental and conversations are ongoing. If you\nare a content creator you can skip this page.")),(0,r.kt)("p",null,"This page describes the functions of the Web Monetization provider and\nhow the provider could manifest as a payment handler. Web Monetization providers\nare also known as Web Monetization senders."),(0,r.kt)("p",null,"A Web Monetization sender is a digital entity that makes payments on behalf of\na user and is capable of sending micropayments to Web Monetization receivers."),(0,r.kt)("p",null,"The Web Monetization sender interfaces with a browser so the Web Monetization\nagent (e.g. extension) can send payment instructions, such as who to pay, when,\nand how much."),(0,r.kt)("h2",{id:"payment-handler-api"},"Payment Handler API"),(0,r.kt)("p",null,"Our expectation is the Web Monetization (WM) sender will manifest as a payment\nhandler as follows."),(0,r.kt)("p",null,"The WM sender interface leverages the Payment Handler API. The API contains\ncapabilities that enable web applications to handle requests for payments. You\ncan read the working draft of the spec on the\n",(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/payment-handler/"},"W3C website"),"."),(0,r.kt)("p",null,"The Payment Handler API aligns well with the model anticipated for WM senders:\nA WM sender could manifest as a specialized payment handler capable of returning\nnot just a ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentResponse")," but also a handle to a stream of micropayments."),(0,r.kt)("h3",{id:"monetization---payment-method"},(0,r.kt)("inlineCode",{parentName:"h3"},"monetization")," - payment method"),(0,r.kt)("p",null,"Payment handlers able to act as WM senders ",(0,r.kt)("strong",{parentName:"p"},"MUST")," register themselves with the\nplatform as supportive of the ",(0,r.kt)("inlineCode",{parentName:"p"},"monetization")," payment method."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"monetization")," payment method identifier will be registered as a\n",(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/payment-method-id/#standardized-payment-method-identifiers"},"standardized payment method"),"\nthrough the Web Payments WG at W3C."),(0,r.kt)("h3",{id:"paymentrequestevent---event"},(0,r.kt)("inlineCode",{parentName:"h3"},"PaymentRequestEvent")," - event"),(0,r.kt)("p",null,"When the user's browser sends a payment via the WM sender, the browser emits a\n",(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/payment-handler/#the-paymentrequestevent"},(0,r.kt)("inlineCode",{parentName:"a"},"PaymentRequestEvent")),"."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent")," contains a single\n",(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/payment-request/#paymentmethoddata-dictionary"},(0,r.kt)("inlineCode",{parentName:"a"},"PaymentMethodData")),"\ndictionary in the ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent.methodData")," property."),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentMethodData")," dictionary contains the value ",(0,r.kt)("inlineCode",{parentName:"p"},"monetization")," in the\n",(0,r.kt)("inlineCode",{parentName:"p"},"supportedMethods")," property. ",(0,r.kt)("inlineCode",{parentName:"p"},"data")," is an instance of a\n",(0,r.kt)("a",{parentName:"p",href:"#monetizationrequest---dictionary"},(0,r.kt)("inlineCode",{parentName:"a"},"MonetizationRequest"))," containing the\ndestination (WM receiver) address to send to, the condition, and expiry values\nto use. The payment handler uses this data to send a single Interledger payment\nto the destination address. The amount sent by the payment handler is the amount\nspecified in ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent.total"),". ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent.total")," is an\ninstance of ",(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/payment-request/#paymentcurrencyamount-dictionary"},(0,r.kt)("inlineCode",{parentName:"a"},"PaymentCurrencyAmount")),"\nspecifying both an amount (",(0,r.kt)("inlineCode",{parentName:"p"},"value"),") and a ",(0,r.kt)("inlineCode",{parentName:"p"},"currency"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-webidl"},"dictionary PaymentCurrencyAmount {\n  required DOMString currency;\n  required DOMstring value;\n};\n")),(0,r.kt)("p",null,"The payment handler then invokes ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent.respondWith()"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"paymentRequestEvent.respondWith(\n    // Promise that resolves with a PaymentResponse.\n  )\n")),(0,r.kt)("p",null,"And responds with either a pass or a fail:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Pass - passes in a ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," that resolves to an instance of\n",(0,r.kt)("a",{parentName:"p",href:"#monetizationresponse---dictionary"},(0,r.kt)("inlineCode",{parentName:"a"},"MonetizationResponse"))," containing the\nfulfillment and data from the response."),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/WICG/webmonetization/issues/15"},"Issue 15 - Should Web Monetization senders know origin of the monetized website?"),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent")," currently includes the origin of the calling website. Should this be removed for monetization to preserve the user's privacy?")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Fail - provides a rejected ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," indicating that the payment failed\nbecause the handler was unable to send in the specified currency."),(0,r.kt)("blockquote",{parentName:"li"},(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("a",{parentName:"p",href:"https://github.com/WICG/webmonetization/issues/18"},"Issue 18 - Indicate Failure Reasons from Web Monetization Sender"))))),(0,r.kt)("p",null,"For more information about the JavaScript ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," object, see the\n",(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"},"MDN Web docs"),"."),(0,r.kt)("h3",{id:"monetizationrequest---dictionary"},(0,r.kt)("inlineCode",{parentName:"h3"},"MonetizationRequest")," - dictionary"),(0,r.kt)("p",null,"The data in the ",(0,r.kt)("inlineCode",{parentName:"p"},"MonetizationRequest")," emitted to the payment handler contains\nthe destination (WM receiver) address for the payment, the condition, expiry,\nand data to use in the Interledger packet."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-webidl"},"  dictionary MonetizationRequest {\n    required DOMString destination;\n    required DOMString condition;\n    required DOMString expiry;\n    DOMString data;\n  };\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"destination"),(0,r.kt)("td",{parentName:"tr",align:null},"The ILP address of the WM receiver for this session.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"condition"),(0,r.kt)("td",{parentName:"tr",align:null},"32 bytes, base64-encoded condition to use for the ILP packet. The WM receiver must be able to fulfill this condition.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"expiry"),(0,r.kt)("td",{parentName:"tr",align:null},"Expiration date and time for when the ILP packet expires.")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"data"),(0,r.kt)("td",{parentName:"tr",align:null},"Base64-encoded additional data to send in the ILP packet.")))),(0,r.kt)("h3",{id:"monetizationresponse---dictionary"},(0,r.kt)("inlineCode",{parentName:"h3"},"MonetizationResponse")," - dictionary"),(0,r.kt)("p",null,"The data in the ",(0,r.kt)("inlineCode",{parentName:"p"},"MonetizationResponse")," that is sent by the payment handler\ncontains the fulfillment from the successful payment and the data from the\nfulfill packet."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-webidl"},"  dictionary MonetizationRequest {\n    required DOMString fulfillment;\n    DOMString data;\n  };\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Property"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"fulfillment"),(0,r.kt)("td",{parentName:"tr",align:null},"32 bytes, base64-encoded fulfillment from the ILP packet (returned by the payee).")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"data"),(0,r.kt)("td",{parentName:"tr",align:null},"Base64-encoded additional data received from the ILP packet.")))),(0,r.kt)("h2",{id:"open-authorization-issues"},"Open authorization issues"),(0,r.kt)("p",null,"When the payment handler is invoked (handling a new ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent"),") it's\nexpected to send a payment on behalf of the user."),(0,r.kt)("p",null,"If the payment handler is not authorized to send payments it can either:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Invoke ",(0,r.kt)("inlineCode",{parentName:"li"},"PaymentRequestEvent.openWindow()")," to provide a UI to the user to log\nin and authorize the payment"),(0,r.kt)("li",{parentName:"ul"},"Reject the request by passing a rejected ",(0,r.kt)("inlineCode",{parentName:"li"},"Promise")," to\n",(0,r.kt)("inlineCode",{parentName:"li"},"PaymentRequestEvent.respondWith()")," and let the browser handle the case")),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Invoke")," is quite intrusive on the user experience unless it's throttled by the\nbrowser in some way. ",(0,r.kt)("em",{parentName:"p"},"Reject")," is likely to result in a lot of failures that go\nundetected."),(0,r.kt)("h2",{id:"supporting-payment-streams"},"Supporting payment streams"),(0,r.kt)("p",null,"As detailed in the ",(0,r.kt)("a",{parentName:"p",href:"/docs/explainer"},"explainer"),", the user's browser receives a\nunique destination address and shared secret for each monetization session (e.g.\npage refresh, navigation). This specification assumes that the browser will\nhandle the generation of a new condition using the shared secret for each\npayment it wants to send."),(0,r.kt)("p",null,"Note that the browser will then emit multiple ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequestEvent")," events (one\nfor each payment). This is in contrast to how the event is expected to be\nemitted. The expectation is that a website creates a single ",(0,r.kt)("inlineCode",{parentName:"p"},"PaymentRequest"),"\nevent. The single event is emitted as a result of the website calling ",(0,r.kt)("inlineCode",{parentName:"p"},"show()"),"\nand the user selecting a payment instrument. In this case (with a single\nevent), the calling website waits for the ",(0,r.kt)("inlineCode",{parentName:"p"},"Promise")," returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"show()"),",\nthen resolves the value passed by the payment handler to ",(0,r.kt)("inlineCode",{parentName:"p"},"respondWith()"),"."),(0,r.kt)("p",null,"While this proposal requires minimal changes to the Payment Handler API\nspecification it does imply some changes to the\n",(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/payment-handler/#handling-a-payment-request"},"Handling a Payment Request"),"\nand ",(0,r.kt)("a",{parentName:"p",href:"https://www.w3.org/TR/payment-handler/#dfn-methoddata-population-algorithm"},"MethodData Population"),"\nalgorithms."))}m.isMDXComponent=!0}}]);